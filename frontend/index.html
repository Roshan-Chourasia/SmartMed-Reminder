<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Medicine Reminder</title>
  <link rel="icon" type="image/png" href="assets/icons/favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script src="https://cdn.lordicon.com/lordicon.js"></script>
</head>

<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="navbar-brand">
      <span class="navbar-icon"><img src="assets/icons/favicon.png" alt="SmartMed Reminder Logo" width="40px"></span>
      <span class="navbar-title">SmartMed Reminder</span>
    </div>
    <ul class="navbar-menu">
      <li><a href="#home" class="navbar-link" onclick="scrollToSection('home'); return false;">Home</a></li>
      <li id="navPatients" class="navbar-link"><a href="#patients" class="navbar-link" onclick="scrollToSection('patients'); return false;">Patients</a></li>
      <li id="navDevices" class="navbar-link"><a href="#devices" class="navbar-link" onclick="scrollToSection('devices'); return false;">Devices</a></li>
      <li><a href="#set-time" class="navbar-link" onclick="scrollToSection('set-time'); return false;">Set Time</a></li>
      <li><a href="#history" class="navbar-link" onclick="scrollToSection('history'); return false;">History</a></li>
      <li><a id="authLink" href="login.html" class="navbar-link">Login</a></li>
    </ul>
  </nav>

  <div class="container">
    <!-- Home Section (Top of page) -->
    <section id="home" class="hero-section">
      <h1>Smart Medicine Reminder System.</h1>
      <p>Manage your medication schedule with ease.</p>
    </section>

    <!-- Set Dose Times Card -->
    <section id="set-time" class="card">
      <div class="card-header">
        <h2 class="card-title"><img src="assets/icons/clock.png" alt="Clock Icon" width="30px"> Set Dose Times</h2>
      </div>

      <table class="dose-times-table">
        <thead>
          <tr>
            <th>Medicine</th>
            <th>Before Meal</th>
            <th>After Meal</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <span class="meal-label">üåÖ Morning</span>
            </td>
            <td>
              <div class="time-cell">
                <div class="time-input-wrapper">
                  <input type="time" id="morningBefore" class="form-input" placeholder="HH:MM">
                  <button onclick="updateDoseTime('morning','before')" class="btn btn-icon btn-primary"
                    title="Save"><lord-icon src="https://cdn.lordicon.com/cbtlerlm.json" trigger="hover" stroke="bold"
                      style="width:20px;height:20px">
                    </lord-icon></button>
                  <button onclick="deleteDoseTime('morning','before')" class="btn btn-icon btn-danger"
                    title="Delete"><lord-icon src="https://cdn.lordicon.com/sxhqklqh.json" trigger="hover" stroke="bold"
                      colors="primary:#000000,secondary:#ffffff,tertiary:#646e78" style="width:20px;height:20px">
                    </lord-icon></button>
                </div>
                <span class="form-helper">Before breakfast reminder</span>
              </div>
            </td>
            <td>
              <div class="time-cell">
                <div class="time-input-wrapper">
                  <input type="time" id="morningAfter" class="form-input" placeholder="HH:MM">
                  <button onclick="updateDoseTime('morning','after')" class="btn btn-icon btn-primary"
                    title="Save"><lord-icon src="https://cdn.lordicon.com/cbtlerlm.json" trigger="hover" stroke="bold"
                      style="width:20px;height:20px">
                    </lord-icon></button>
                  <button onclick="deleteDoseTime('morning','after')" class="btn btn-icon btn-danger"
                    title="Delete"><lord-icon src="https://cdn.lordicon.com/sxhqklqh.json" trigger="hover" stroke="bold"
                      colors="primary:#000000,secondary:#ffffff,tertiary:#646e78" style="width:20px;height:20px">
                    </lord-icon></button>
                </div>
                <span class="form-helper">After breakfast reminder</span>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <span class="meal-label">‚òÄÔ∏è Afternoon</span>
            </td>
            <td>
              <div class="time-cell">
                <div class="time-input-wrapper">
                  <input type="time" id="afternoonBefore" class="form-input" placeholder="HH:MM">
                  <button onclick="updateDoseTime('afternoon','before')" class="btn btn-icon btn-primary"
                    title="Save"><lord-icon src="https://cdn.lordicon.com/cbtlerlm.json" trigger="hover" stroke="bold"
                      style="width:20px;height:20px">
                    </lord-icon></button>
                  <button onclick="deleteDoseTime('afternoon','before')" class="btn btn-icon btn-danger"
                    title="Delete"><lord-icon src="https://cdn.lordicon.com/sxhqklqh.json" trigger="hover" stroke="bold"
                      colors="primary:#000000,secondary:#ffffff,tertiary:#646e78" style="width:20px;height:20px">
                    </lord-icon></button>
                </div>
                <span class="form-helper">Before lunch reminder</span>
              </div>
            </td>
            <td>
              <div class="time-cell">
                <div class="time-input-wrapper">
                  <input type="time" id="afternoonAfter" class="form-input" placeholder="HH:MM">
                  <button onclick="updateDoseTime('afternoon','after')" class="btn btn-icon btn-primary"
                    title="Save"><lord-icon src="https://cdn.lordicon.com/cbtlerlm.json" trigger="hover" stroke="bold"
                      style="width:20px;height:20px">
                    </lord-icon></button>
                  <button onclick="deleteDoseTime('afternoon','after')" class="btn btn-icon btn-danger"
                    title="Delete"><lord-icon src="https://cdn.lordicon.com/sxhqklqh.json" trigger="hover" stroke="bold"
                      colors="primary:#000000,secondary:#ffffff,tertiary:#646e78" style="width:20px;height:20px">
                    </lord-icon></button>
                </div>
                <span class="form-helper">After lunch reminder</span>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <span class="meal-label">üåô Night</span>
            </td>
            <td>
              <div class="time-cell">
                <div class="time-input-wrapper">
                  <input type="time" id="nightBefore" class="form-input" placeholder="HH:MM">
                  <button onclick="updateDoseTime('night','before')" class="btn btn-icon btn-primary"
                    title="Save"><lord-icon src="https://cdn.lordicon.com/cbtlerlm.json" trigger="hover" stroke="bold"
                      style="width:20px;height:20px">
                    </lord-icon></button>
                  <button onclick="deleteDoseTime('night','before')" class="btn btn-icon btn-danger"
                    title="Delete"><lord-icon src="https://cdn.lordicon.com/sxhqklqh.json" trigger="hover" stroke="bold"
                      colors="primary:#000000,secondary:#ffffff,tertiary:#646e78" style="width:20px;height:20px">
                    </lord-icon></button>
                </div>
                <span class="form-helper">Before dinner reminder</span>
              </div>
            </td>
            <td>
              <div class="time-cell">
                <div class="time-input-wrapper">
                  <input type="time" id="nightAfter" class="form-input" placeholder="HH:MM">
                  <button onclick="updateDoseTime('night','after')" class="btn btn-icon btn-primary"
                    title="Save"><lord-icon src="https://cdn.lordicon.com/cbtlerlm.json" trigger="hover" stroke="bold"
                      style="width:20px;height:20px">
                    </lord-icon></button>
                  <button onclick="deleteDoseTime('night','after')" class="btn btn-icon btn-danger"
                    title="Delete"><lord-icon src="https://cdn.lordicon.com/sxhqklqh.json" trigger="hover" stroke="bold"
                      colors="primary:#000000,secondary:#ffffff,tertiary:#646e78" style="width:20px;height:20px">
                    </lord-icon></button>
                </div>
                <span class="form-helper">After dinner reminder</span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      <hr>

      <div class="repeat-controls">
        <label for="repeatPreset"><strong>Repeat for:</strong></label>
        <select id="repeatPreset" class="form-select">
          <option value="0">Today only</option>
          <option value="3">3 days</option>
          <option value="7">7 days (1 week)</option>
          <option value="14">14 days (2 weeks)</option>
          <option value="30">30 days (1 month)</option>
          <option value="90">90 days (3 months)</option>
          <option value="custom">Custom‚Ä¶</option>
        </select>

        <span id="customRepeatControls" style="display: none;" class="custom-repeat-wrapper">
          <input type="number" id="customRepeatNumber" class="form-input" min="1" max="365" value="7">
          <select id="customRepeatUnit" class="form-select">
            <option value="days">days</option>
            <option value="weeks">weeks</option>
            <option value="months">months</option>
          </select>
        </span>

        <button onclick="saveDoseTimes()" class="btn btn-primary"><lord-icon
            src="https://cdn.lordicon.com/vwzukuhn.json" trigger="hover" stroke="bold"
            colors="primary:#000000,secondary:#e83a30,tertiary:#ffc738,quaternary:#ffffff"
            style="width:25px;height:25px">
          </lord-icon> Save Dose Times</button>
      </div>
    </section>

    <!-- Patient Info Card (for patient role) -->
    <section id="patientInfo" class="card" style="display: none;">
      <div class="card-header">
        <h2 class="card-title"><img src="assets/icons/medicine.png" alt="Info Icon" width="30px"> Your Information</h2>
      </div>
      <div id="patientInfoContent" class="patients-list">
        <!-- Patient info will be loaded here -->
      </div>
    </section>

    <!-- Patient Management Card (for caregiver role) -->
    <section id="patients" class="card">
      <div class="card-header">
        <h2 class="card-title"><img src="assets/icons/medicine.png" alt="Patient Icon" width="30px"> Patient Management</h2>
        <button onclick="showCreatePatientModal()" class="btn btn-primary">
          <lord-icon src="https://cdn.lordicon.com/vwzukuhn.json" trigger="hover" stroke="bold"
            colors="primary:#ffffff" style="width:20px;height:20px">
          </lord-icon> Add Patient
        </button>
      </div>

      <div id="patientsList" class="patients-list">
        <!-- Patients will be loaded here -->
        <div class="empty-state">
          <div class="empty-state-icon">üë§</div>
          <div class="empty-state-text">No patients found. Create your first patient to get started.</div>
        </div>
      </div>
    </section>

    <!-- Device Management Card (for caregiver role) -->
    <section id="devices" class="card">
      <div class="card-header">
        <h2 class="card-title">üîå Device Management</h2>
      </div>

      <div id="devicesList" class="devices-list">
        <!-- Devices will be loaded here -->
        <div class="empty-state">
          <div class="empty-state-icon">üì±</div>
          <div class="empty-state-text">No devices linked. Link a device to a patient to start tracking.</div>
        </div>
      </div>
    </section>

    <!-- Dose History Card -->
    <section id="history" class="card">
      <div class="card-header">
        <h2 class="card-title"><img src="assets/icons/history.png" alt="History Icon" width="30px"> Dose History</h2>
        <button id="toggleFilterButton" onclick="toggleFilterPanel()" class="btn btn-secondary"><lord-icon
            src="https://cdn.lordicon.com/iuvnsegf.json" trigger="hover" stroke="bold"
            colors="primary:#000000,secondary:#110a5c,tertiary:#30c9e8,quaternary:#a66037"
            style="width:20px;height:20px">
          </lord-icon> Filter</button>
      </div>

      <div id="filterPanel" class="filter-panel">
        <div id="deviceSelectorSection" class="filter-section" style="display: none;">
          <label class="filter-label">Patient / Device</label>
          <select id="deviceSelector" class="form-select" onchange="handleDeviceSelectionChange()">
            <option value="">Select a patient...</option>
            <!-- Options will be populated by JavaScript -->
          </select>
          <span class="form-helper">Select which patient's device to manage</span>
        </div>

        <div class="filter-section">
          <label class="filter-label">Date Range</label>
          <div class="date-range-inputs">
            <input type="date" id="filterDateFrom" class="form-input">
            <span>to</span>
            <input type="date" id="filterDateTo" class="form-input">
          </div>
        </div>

        <div class="filter-section">
          <label class="filter-label">Medicine</label>
          <div class="filter-chips">
            <label class="filter-chip">
              <input type="checkbox" id="filterMealMorning" checked>
              <span>üåÖ Morning</span>
            </label>
            <label class="filter-chip">
              <input type="checkbox" id="filterMealAfternoon" checked>
              <span>‚òÄÔ∏è Afternoon</span>
            </label>
            <label class="filter-chip">
              <input type="checkbox" id="filterMealNight" checked>
              <span>üåô Night</span>
            </label>
          </div>
        </div>

        <div class="filter-section">
          <label class="filter-label">Timing</label>
          <div class="filter-chips">
            <label class="filter-chip">
              <input type="checkbox" id="filterTimingBefore" checked>
              <span>üçΩ Before meal</span>
            </label>
            <label class="filter-chip">
              <input type="checkbox" id="filterTimingAfter" checked>
              <span>üçõ After meal</span>
            </label>
          </div>
        </div>

        <div class="filter-section">
          <label class="filter-label">Status</label>
          <div class="filter-chips">
            <label class="filter-chip">
              <input type="checkbox" id="filterStatusTaken" checked>
              <span>‚úÖ Taken</span>
            </label>
            <label class="filter-chip">
              <input type="checkbox" id="filterStatusMissed" checked>
              <span>‚ùå Missed</span>
            </label>
          </div>
        </div>

        <div class="filter-actions">
          <button onclick="applyFilters()" class="btn btn-primary"><lord-icon
              src="https://cdn.lordicon.com/efxgwrkc.json" trigger="hover" colors="primary:#ffffff"
              style="width:20px;height:20px">
            </lord-icon> Apply Filters</button>
          <button onclick="clearFilters()" class="btn btn-secondary"><lord-icon
              src="https://cdn.lordicon.com/xyfswyxf.json" trigger="morph" state="morph-trash-full-to-empty"
              style="width:20px;height:20px">
            </lord-icon> Clear Filters</button>
        </div>
      </div>

      <div class="history-table-wrapper">
        <table id="logTable" class="history-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Medicine</th>
              <th>Scheduled</th>
              <th>Time</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows will be populated by JavaScript -->
          </tbody>
        </table>
      </div>

      <div id="paginationContainer" class="pagination-container">
        <div class="pagination-controls">
          <label for="rowsPerPage" class="form-label" style="margin: 0; display: inline;">Rows per page:</label>
          <select id="rowsPerPage" class="form-select" onchange="changeRowsPerPage()"
            style="width: auto; display: inline-block;">
            <option value="5">5</option>
            <option value="10" selected>10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
        <div class="pagination-controls">
          <button id="prevPageButton" onclick="goToPrevPage()" class="btn btn-secondary">‚Üê Prev</button>
          <span id="paginationInfo" class="pagination-info"></span>
          <button id="nextPageButton" onclick="goToNextPage()" class="btn btn-secondary">Next ‚Üí</button>
        </div>
      </div>
    </section>
  </div>

  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <!-- API Configuration - Update this after deploying backend to Render -->
  <script>
    // Set your Render backend URL here after deployment
    // Format: https://your-backend.onrender.com
    window.API_URL = window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1" 
  ? "http://localhost:5000" 
  : "https://smart-medicine-reminder-backend.onrender.com";
  </script>
  <!-- Create Patient Modal -->
  <div id="createPatientModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="card-header">
        <h2 class="card-title">Add New Patient</h2>
        <button onclick="closeCreatePatientModal()" class="btn btn-secondary" style="padding: 8px 12px;">‚úï</button>
      </div>
      <form id="createPatientForm" onsubmit="handleCreatePatient(event)">
        <div class="form-group">
          <label class="form-label" for="patientName">Name *</label>
          <input type="text" id="patientName" class="form-input" placeholder="Patient name" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="patientAge">Age</label>
          <input type="number" id="patientAge" class="form-input" placeholder="Age" min="0" max="150">
        </div>
        <div class="form-group">
          <label class="form-label" for="caregiverName">Caregiver Name</label>
          <input type="text" id="caregiverName" class="form-input" placeholder="Caregiver name">
        </div>
        <div class="form-group">
          <label class="form-label" for="caregiverPhone">Caregiver Phone</label>
          <input type="tel" id="caregiverPhone" class="form-input" placeholder="Phone number">
        </div>
        <div class="form-group">
          <label class="form-label" for="patientEmail">Patient Email (optional)</label>
          <input type="email" id="patientEmail" class="form-input" placeholder="patient@example.com">
          <span class="form-helper">If the patient has their own login, enter their email.</span>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
          <button type="button" onclick="closeCreatePatientModal()" class="btn btn-secondary">Cancel</button>
          <button type="submit" class="btn btn-primary">Create Patient</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Link Device Modal -->
  <div id="linkDeviceModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="card-header">
        <h2 class="card-title">Link Device</h2>
        <button onclick="closeLinkDeviceModal()" class="btn btn-secondary" style="padding: 8px 12px;">‚úï</button>
      </div>
      <form id="linkDeviceForm" onsubmit="handleLinkDevice(event)">
        <input type="hidden" id="linkPatientId">
        <div class="form-group">
          <label class="form-label" for="deviceIdInput">Device ID *</label>
          <input type="text" id="deviceIdInput" class="form-input" placeholder="e.g., DEVICE_001" required>
          <span class="form-helper">Enter the device ID from your ESP32</span>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
          <button type="button" onclick="closeLinkDeviceModal()" class="btn btn-secondary">Cancel</button>
          <button type="submit" class="btn btn-primary">Link Device</button>
        </div>
      </form>
    </div>
  </div>

  <script src="auth.js"></script>
  <script src="patient.js"></script>
  <script src="device.js"></script>
  <script src="script.js"></script>
</body>

</html>